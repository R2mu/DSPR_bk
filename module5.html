<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GWS Data Science and Problem Recognition - 6&nbsp; Module 5</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./module4.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./module5.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Module 5</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GWS Data Science and Problem Recognition</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Module 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Module 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Module 3</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Module 4</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module5.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Module 5</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">references.html</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#goals-for-this-week." id="toc-goals-for-this-week." class="nav-link active" data-scroll-target="#goals-for-this-week."><span class="header-section-number">6.1</span> Goals for this week.</a></li>
  <li><a href="#recap-from-last-module" id="toc-recap-from-last-module" class="nav-link" data-scroll-target="#recap-from-last-module"><span class="header-section-number">6.2</span> Recap from last module</a></li>
  <li><a href="#load-data-and-r-packages" id="toc-load-data-and-r-packages" class="nav-link" data-scroll-target="#load-data-and-r-packages"><span class="header-section-number">6.3</span> Load data and R packages</a></li>
  <li><a href="#data-splitting" id="toc-data-splitting" class="nav-link" data-scroll-target="#data-splitting"><span class="header-section-number">6.4</span> Data splitting</a></li>
  <li><a href="#assessing-continuous-responses" id="toc-assessing-continuous-responses" class="nav-link" data-scroll-target="#assessing-continuous-responses"><span class="header-section-number">6.5</span> Assessing continuous responses</a></li>
  <li><a href="#simple-gaussian-example" id="toc-simple-gaussian-example" class="nav-link" data-scroll-target="#simple-gaussian-example"><span class="header-section-number">6.6</span> Simple Gaussian example</a>
  <ul class="collapse">
  <li><a href="#quick-note-of-cv" id="toc-quick-note-of-cv" class="nav-link" data-scroll-target="#quick-note-of-cv"><span class="header-section-number">6.6.1</span> Quick note of CV</a></li>
  </ul></li>
  <li><a href="#assessing-binomiallogistic-models" id="toc-assessing-binomiallogistic-models" class="nav-link" data-scroll-target="#assessing-binomiallogistic-models"><span class="header-section-number">6.7</span> Assessing Binomial/logistic models</a></li>
  <li><a href="#binomial-example" id="toc-binomial-example" class="nav-link" data-scroll-target="#binomial-example"><span class="header-section-number">6.8</span> Binomial example</a></li>
  <li><a href="#feature-selection---l1" id="toc-feature-selection---l1" class="nav-link" data-scroll-target="#feature-selection---l1"><span class="header-section-number">6.9</span> Feature selection - L1</a></li>
  <li><a href="#feature-selection---alternate-methods" id="toc-feature-selection---alternate-methods" class="nav-link" data-scroll-target="#feature-selection---alternate-methods"><span class="header-section-number">6.10</span> Feature selection - Alternate methods</a></li>
  <li><a href="#feature-selection---gam" id="toc-feature-selection---gam" class="nav-link" data-scroll-target="#feature-selection---gam"><span class="header-section-number">6.11</span> Feature selection - GAM</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Module 5</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="goals-for-this-week." class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="goals-for-this-week."><span class="header-section-number">6.1</span> Goals for this week.</h2>
<p>Our current outline for the next out weeks looks like the below.</p>
<ol type="1">
<li><p>Introduction into R programming language and getting started with some descriptive statistics.</p></li>
<li><p>Understanding key terms; Exploratory analysis, Supervised vs Unsupervised problems, regression vs classification, prediction vs association.</p></li>
<li><p>A quick note on distributions - Supervised regression and classification problems using a generalized linear model framework. (Hypothesis testing)</p></li>
<li><p>Machine learning approach to Supervised learning</p></li>
<li><p><strong>Methods of assessing model accuracy, feature selection and model tuning.</strong></p></li>
<li><p>Unsupervised learning strategies2 (market basket analysis, network analysis)</p></li>
<li><p>Creating a machine learning pipeline</p></li>
</ol>
</section>
<section id="recap-from-last-module" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="recap-from-last-module"><span class="header-section-number">6.2</span> Recap from last module</h2>
<p>In our last module, we explored commonly used machine learning algorithms, focusing on Decision Trees and Random Forests. We discussed how Decision Trees offer good interpretability but have limitations in performance. We then examined how Random Forests attempt to overcome these limitations, often achieving good out-of-the-bag performance with minimal tuning.</p>
<p>However, we encountered a crucial insight: even powerful algorithms like Random Forests can sometimes overfit the data. We demonstrated this by comparing the Random Forest to a Generalized Additive Model (GAM), using the technique of splitting our data into training and test sets. This approach allowed us to train models on one subset of data and evaluate their performance on unseen data, revealing potential overfitting issues.</p>
<p>This week, we’ll delve deeper into strategies for mitigating overfitting risks and assessing model performance. We’ll explore:</p>
<ol type="1">
<li><p><strong>Cross-validation:</strong> We briefly mentioned this technique last week as a method to help prevent overfitting. We’ll now examine it in more detail, understanding how it provides a more robust evaluation of model performance.</p></li>
<li><p><strong>Model Performance Metrics</strong>: We’ll cover common statistics used to assess model accuracy for both classification and regression problems. For binary classification (e.g., Goal/Miss), we’ll look at metrics such as accuracy, precision, recall, and F1-score. For regression problems with continuous outcomes, we’ll explore metrics like Root Mean Square Error (RMSE) and R-squared.</p></li>
<li><p><strong>Bias-Variance relationship:</strong> Introduce the concept of the Bias variance relationship.</p></li>
</ol>
<p>Time permitting, we’ll tie these concepts together by exploring penalized regression, an algorithm that inherently incorporates feature selection and model tuning. This will provide a practical example of how these elements work together in advanced machine learning techniques.</p>
<p>Learning Objectives: By the end of this module, you should be able to:</p>
<ul>
<li><p>Understand and apply cross-validation techniques</p></li>
<li><p>Calculate and interpret common performance metrics for classification and regression models</p></li>
<li><p>Recognize the importance of feature selection and apply basic selection techniques</p></li>
<li><p>Understand the concept of model tuning and its role in improving model performance</p></li>
</ul>
<p>Please note that assessing model performance is a vast area in statistics and machine learning. While we can’t cover all existing metrics and techniques, this module will equip you with a solid foundation in the most commonly used and practical approaches.</p>
</section>
<section id="load-data-and-r-packages" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="load-data-and-r-packages"><span class="header-section-number">6.3</span> Load data and R packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://gavinsimpson.github.io/gratia/reference/data_sim.html</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(data.table,tidyverse,caret,mgcv,ggtext,FactoMineR,factoextra,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>               pdp,ranger,glue,patchwork,glmnet,CalibrationCurves,DescTools)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>urlfile<span class="ot">=</span><span class="st">"https://raw.githubusercontent.com/R2mu/GWS_DSPR/main/data/mod5.csv"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>mod5_dat <span class="ot">&lt;-</span> <span class="fu">fread</span>(urlfile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This data set represents Team Data by QUARTER. Have a think about what R functions you could use to start to feel comfortable with the data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## drop columns that obviously related to the outcome</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>mod5_dat<span class="ot">&lt;-</span>mod5_dat[,<span class="sc">!</span><span class="fu">c</span>(<span class="st">"BEHIND"</span>,<span class="st">"POINTS"</span>,<span class="st">"GOAL"</span>,<span class="st">"SHOT_AT_GOAL"</span>,<span class="st">"HANDBALL_GAIN_METRES"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"SCORE_INVOLVEMENT"</span>,<span class="st">"SCOREBOARD_IMPACT"</span>,<span class="st">"SCORE_LAUNCH"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"INSIDE_50"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  ][, .SD, .SDcols <span class="ot">=</span> <span class="sc">!</span><span class="fu">patterns</span>(<span class="st">"PCNT"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  ][, .SD, .SDcols <span class="ot">=</span> <span class="sc">!</span><span class="fu">patterns</span>(<span class="st">"IN50"</span>)]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="do">## drop columns with highly negatively skewed values </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>is0 <span class="ot">=</span> <span class="cf">function</span>(x)<span class="fu">is.numeric</span>(x) <span class="sc">&amp;&amp;</span>  <span class="fu">quantile</span>(x, <span class="fl">0.25</span>,<span class="at">na.rm =</span>T) <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>m5_dat <span class="ot">&lt;-</span><span class="fu">copy</span>(mod5_dat)[, <span class="fu">which</span>(<span class="fu">sapply</span>(mod5_dat, is0)) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="do">##log transform to help normalize variables later on</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>m5_log <span class="ot">&lt;-</span><span class="fu">copy</span>(m5_dat)[, <span class="fu">names</span>(m5_dat)[<span class="dv">8</span><span class="sc">:</span><span class="dv">94</span>] <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">log</span>(x <span class="sc">+</span> <span class="dv">1</span>)), .SDcols <span class="ot">=</span> <span class="dv">8</span><span class="sc">:</span><span class="dv">94</span>]</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>m5_scaled <span class="ot">&lt;-</span> <span class="fu">copy</span>(m5_log)[, <span class="fu">names</span>(m5_log)[<span class="dv">8</span><span class="sc">:</span><span class="dv">94</span>] <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, scale), .SDcols <span class="ot">=</span> <span class="dv">8</span><span class="sc">:</span><span class="dv">94</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below are some links behind the idea of what we are going to do.</p>
<p><a href="https://mlu-explain.github.io/train-test-validation/" class="uri">https://mlu-explain.github.io/train-test-validation/</a></p>
<p><a href="https://mlu-explain.github.io/cross-validation/" class="uri">https://mlu-explain.github.io/cross-validation/</a></p>
</section>
<section id="data-splitting" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="data-splitting"><span class="header-section-number">6.4</span> Data splitting</h2>
<p>Given the size of most of your data sets you should feel relatively confident in always creating a <strong>training</strong> and a <strong>test</strong> data set. Once you have created these data sets, it is important you put you only end up using the test data set at the end, once you have completed fine tuning your models. There are many R packages that will do data splitting for you but it is quite easy to do using base R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fl">0.7</span> <span class="do">## proportion of rows for training data set </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(m5_scaled), split <span class="sc">*</span> <span class="fu">nrow</span>(m5_scaled))  <span class="co"># randomly sample 70% of row indices from data set. </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>test  <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(m5_scaled), train)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># get remainder of 30% of rows not in training dataset. </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> m5_scaled[train, ]<span class="co"># create training dataset</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>test_data  <span class="ot">&lt;-</span> m5_scaled[test, ]<span class="co"># create test dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now have a data-set called train_data with 2066 rows and a data-set called test_data with 866 rows in it.</p>
<p>As I mentioned earlier, we will now effectively forget about the test data-set until later and just work with the training data-set.</p>
</section>
<section id="assessing-continuous-responses" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="assessing-continuous-responses"><span class="header-section-number">6.5</span> Assessing continuous responses</h2>
<p>For our first model we are going to assess a continuous outcome which is going to be quarter differential. The most common metrics used when assessing a models ability to describe a continuous outcome variable are</p>
<p><strong>Mean Absolute Error (MAE) :</strong> This simply represents the<br>
<br>
<code>mean(abs((actual - predicted)))</code></p>
<p><strong>Mean Squared Error (MSE) :</strong> Very similar to above but instead of taking the absolute of the difference between variables we are going to square the distance. This will penalize poor predictions more than the MAE<br>
<br>
<code>mean((actual - predicted)^2)</code></p>
<p><strong>Root Mean Squared Error (RMSE) :</strong> Similar to above but we now just going to sqrt the MSE to get it back to the same level of the outcome measure.</p>
<p><code>sqrt(mean((actual - predicted)^2))</code> or <code>sqrt(MSE)</code></p>
<p><strong>R2:</strong> This represents the proportion of the variance in the dependent variable that is predictable from the independent variable(s). It ranges from 0 to 1, where 1 indicates perfect prediction.</p>
<p><code>1 - (sum((actual - predicted)^2) / sum((actual - mean(actual))^2))</code></p>
<p><strong>Adjusted R Squared:</strong>This is a modified version of R-squared that adjusts for the number of predictors in the model. It increases only if the new term improves the model more than would be expected by chance.</p>
<p><code>1 - ((1 - R²) * (n - 1) / (n - p - 1))</code></p>
<p>where n is the number of observations and p is the number of predictors.</p>
<p>Notes:</p>
<ul>
<li><p>R-squared can be interpreted as the percentage of variance explained by the model.</p></li>
<li><p>Adjusted R-squared is always lower than R-squared and can be negative.</p></li>
<li><p>While R-squared always increases when adding more variables to the model (even if they’re not meaningful), Adjusted R-squared penalizes the addition of variables that don’t improve the model’s explanatory power.</p></li>
</ul>
<p>These metrics provide different perspectives on model performance. MAE and RMSE are in the same units as the outcome variable, making them easily interpretable. R-squared and Adjusted R-squared give a sense of the model’s overall explanatory power. The choice of which metric to prioritize often depends on the specific needs of your analysis and the characteristics of your data.</p>
<p>Now often you might calculate all of these on both the training data-set and test data-set, as it could give insight into possible over-fitting and also can give insight into the <strong>BIAS-VARIANCE trade off.</strong></p>
<p><a href="https://mlu-explain.github.io/bias-variance/" class="uri">https://mlu-explain.github.io/bias-variance/</a><br>
<a href="https://illustrated-machine-learning.github.io/#/machine-learning/bias-variance" class="uri">https://illustrated-machine-learning.github.io/#/machine-learning/bias-variance</a></p>
<p><img src="bias-variance.png" class="img-fluid" width="594"></p>
<p><img src="bias-variance2.png" class="img-fluid"></p>
<p>I encourage you to have a read through the websites above. But effectively all variables have some noise component of noise to them, as we continually add more and more variables we are effectively adding some noise to the model as well. Initially, important variables will reduce error, but we may get to a stage where we are just adding noise with no improvements in model accuracy.</p>
</section>
<section id="simple-gaussian-example" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="simple-gaussian-example"><span class="header-section-number">6.6</span> Simple Gaussian example</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>m5_small <span class="ot">&lt;-</span> train_data[,.(Diff.Qtr.Points,CLEARANCE,CONTESTED_POSSESSION,CONTESTED_MARK,CRUMB,EFFECTIVE_DISPOSAL,INTERCEPT,HITOUT,KICK_GAIN_METRES,KICK,MARK,LOOSE_BALL_GET,TACKLE,REBOUND_50,METRES_GAINED_EFF,PLY_PRESS_PTS,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>SPOIL,RATING,LONG_KICK,SHORT_KICK,FIRST_POSSESSION)]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>m5_small_tst <span class="ot">&lt;-</span> test_data[,.(Diff.Qtr.Points,CLEARANCE,CONTESTED_POSSESSION,CONTESTED_MARK,CRUMB,EFFECTIVE_DISPOSAL,INTERCEPT,HITOUT,KICK_GAIN_METRES,KICK,MARK,LOOSE_BALL_GET,TACKLE,REBOUND_50,METRES_GAINED_EFF,PLY_PRESS_PTS,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>SPOIL,RATING,LONG_KICK,SHORT_KICK,FIRST_POSSESSION)]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up repeated k-fold cross-validation</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>train.control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>step.model <span class="ot">&lt;-</span> <span class="fu">train</span>(Diff.Qtr.Points <span class="sc">~</span>., <span class="at">data =</span> m5_small,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"leapBackward"</span>, </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">nvmax =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">trControl =</span> train.control</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>bwelim <span class="ot">&lt;-</span> <span class="fu">data.table</span>(step.model<span class="sc">$</span>results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bwelim,<span class="fu">aes</span>(nvmax,RMSE,<span class="at">ymin=</span>RMSE<span class="sc">-</span>RMSESD,<span class="at">ymax=</span>RMSE<span class="sc">+</span>RMSESD))<span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>()<span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(step.model)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From eyeballing we can that from around 8 variables in performance doesn’t really seem to change much. Lets have a look at the coefs. Of quite note, these coefficients have been scaled on log transformed data so they don’t have direct interpretation for absolute values, but you can still look interpret them as absolute magnitude of number being indicative of importance. .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(step.model<span class="sc">$</span>finalModel, <span class="dv">8</span>),<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       (Intercept) EFFECTIVE_DISPOSAL               KICK             TACKLE 
              0.18              -2.14               4.45               4.11 
        REBOUND_50  METRES_GAINED_EFF      PLY_PRESS_PTS              SPOIL 
             -1.16               3.27              -5.11              -0.94 
            RATING 
              9.25 </code></pre>
</div>
</div>
<p>You may notice some weird directions for variables e.g.&nbsp;(“EFFECTIVE_DISPOSAL”,“PLY_PRESS_PTS”) , this likely due to the fact that some of the variables are highly correlated with each other, which can cause flipping of effects in simple regression problems. For example, see below. Whilst, the LM model has not really done anything wrong, its more a problem with us the user having to spend a lot of mental energy contextualizing what the effects actually mean. We will explore some other techniques latter (LASSO) that can help a little in situations where you might expect many variables to be highly correlated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>eg1 <span class="ot">=</span> <span class="fu">ggplot</span>(train_data,<span class="fu">aes</span>(TACKLE,PLY_PRESS_PTS))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>eg2 <span class="ot">=</span> <span class="fu">ggplot</span>(train_data,<span class="fu">aes</span>(EFFECTIVE_DISPOSAL,METRES_GAINED_EFF))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>eg0 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train_data,<span class="fu">aes</span>(PLY_PRESS_PTS,Diff.Qtr.Points))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(eg0,eg1,eg2,<span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Or it could there be another reason???</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>nvar <span class="ot">=</span>step.model<span class="sc">$</span>finalModel<span class="sc">$</span>nvmax<span class="dv">-1</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>results_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">i =</span> <span class="fu">integer</span>(), <span class="at">RMSE =</span> <span class="fu">numeric</span>(),<span class="at">r2 =</span> <span class="fu">numeric</span>(),<span class="at">adjr2 =</span> <span class="fu">numeric</span>())</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nvar) {</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>ip1 <span class="ot">&lt;-</span> i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>form1<span class="ot">&lt;-</span><span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"Diff.Qtr.Points~"</span>, </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste</span>(<span class="fu">names</span>(<span class="fu">coef</span>(step.model<span class="sc">$</span>finalModel,i)[<span class="dv">2</span><span class="sc">:</span> ip1]),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>lmTest <span class="ot">&lt;-</span> <span class="fu">lm</span>(form1,<span class="at">data =</span> train_data)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">&lt;-</span><span class="fu">round</span>(caret<span class="sc">::</span><span class="fu">RMSE</span>(<span class="fu">predict</span>(lmTest,test_data),test_data<span class="sc">$</span>Diff.Qtr.Points),<span class="dv">2</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>results_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results_df, <span class="fu">data.frame</span>(<span class="at">i =</span> i, <span class="at">RMSE =</span> rmse,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">r2 =</span><span class="fu">summary</span>(lmTest)<span class="sc">$</span>r.squared,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">adjr2 =</span> <span class="fu">summary</span>(lmTest)<span class="sc">$</span>adj.r.squared))</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>g1<span class="ot">=</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(bwelim[nvmax<span class="sc">&lt;=</span>nvar,],<span class="at">mapping =</span><span class="fu">aes</span>(nvmax,RMSE,<span class="at">ymin=</span>RMSE<span class="sc">-</span>RMSESD,<span class="at">ymax=</span>RMSE<span class="sc">+</span>RMSESD),</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col=</span><span class="st">"gray"</span>)<span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(results_df,<span class="at">mapping=</span><span class="fu">aes</span>(i,RMSE),<span class="at">col=</span><span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(results_df,<span class="at">mapping=</span><span class="fu">aes</span>(i,RMSE),<span class="at">col=</span><span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">=</span> <span class="fu">ggplot</span>(results_df,<span class="fu">aes</span>(i,r2))<span class="sc">+</span><span class="fu">geom_path</span>()<span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(i,adjr2),<span class="at">col=</span><span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(g1,g2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Key points above.</p>
<p>1) Test performance still worse than cross-validated performance, but still follow a relatively similar shape, which is good to see and could be argued test performance is technically within CV performance range.</p>
<p>2) A little harder to see but adjusted r2 (in red) gets lower as we add more values when compared to just the r2 value.</p>
<section id="quick-note-of-cv" class="level3" data-number="6.6.1">
<h3 data-number="6.6.1" class="anchored" data-anchor-id="quick-note-of-cv"><span class="header-section-number">6.6.1</span> Quick note of CV</h3>
<p>Within the code above, the model was tuned using cross validation. There are endless packages in R that will performance k-fold cross validation for you but below is just a quick overview of what is happening behind the scenes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>nfolds <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2066</span><span class="sc">/</span>nfolds <span class="do">## data put aside for internal validation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 413.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="dv">2066</span><span class="sc">-</span>(<span class="dv">2066</span><span class="sc">/</span>nfolds),<span class="dv">0</span>) <span class="do">## data put aside for internal training</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1653</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(train_data<span class="sc">$</span>QtrWL,<span class="at">k =</span> nfolds)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(folds, length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fold1 Fold2 Fold3 Fold4 Fold5 
  413   413   414   413   413 </code></pre>
</div>
</div>
</section>
</section>
<section id="assessing-binomiallogistic-models" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="assessing-binomiallogistic-models"><span class="header-section-number">6.7</span> Assessing Binomial/logistic models</h2>
<p>We will now explore how we go about assessing binary responses, e.g., yes vs.&nbsp;no, goal vs.&nbsp;miss. While some of the steps and statistics will be quite similar to those used for continuous outcomes, assessing binomial outcomes is usually more extensive. There are good reasons for this complexity:</p>
<ol type="1">
<li><p><strong>Decision-making:</strong> Many real-world situations, particularly in medicine, require individuals to make dichotomous decisions based on probabilistic information.</p></li>
<li><p><strong>Risk thresholds:</strong> Different individuals or contexts may have different thresholds for what constitutes an acceptable level of risk.</p></li>
<li><p><strong>Competing risks:</strong> In many scenarios, the decision to act or not act comes with its own set of risks and benefits that need to be weighed against each other.</p></li>
<li><p><strong>Probability interpretation</strong>: Understanding and accurately interpreting probabilities can be challenging for many people.</p></li>
</ol>
<p>As a result, statisticians and researchers have proposed many different metrics that aim to provide various perspectives on model performance. These metrics help contextualize the results, aiding people in ultimately making decisions based on what is fundamentally a probability output.</p>
<p>Some key metrics we’ll explore include:</p>
<ol type="1">
<li><p><strong>Accuracy</strong>: The overall correct classification rate.</p></li>
<li><p><strong>Sensitivity (Recall):</strong> The true positive rate; Proportion of actual positives correctly identified. Usually care about this when the cost of a false negative is high.</p></li>
<li><p><strong>Specificity:</strong> The true negative rate; Proportion of negatives correctly identified.</p></li>
<li><p><strong>Precision:</strong> The positive predictive value; Proportion of positive identification were actually correct. Usually care about this when the cost of a false positive is high.</p></li>
<li><p><strong>F1 Score:</strong> The harmonic mean of precision and recall.</p></li>
<li><p><strong>ROC curve and AUC/ C statistic:</strong> A graphical plot that illustrates the diagnostic ability of a binary classifier system as its discrimination threshold is varied.</p></li>
<li><p><strong>Confusion Matrix:</strong> A table layout of correct and incorrect classifications.</p></li>
<li><p><strong>Brier Score:</strong> A measure of the mean squared difference between the predicted probability and the actual outcome. Lower scores indicate better calibration of probability estimates.</p></li>
<li><p><strong>Calibration statistics</strong>: Measures how well the predicted probabilities of a model match the observed frequencies. This can include calibration plots, and other metrics that assess the reliability of probability estimates.</p></li>
</ol>
<p>Each of these metrics provides a different insight into model performance, and the choice of which to prioritize often depends on the specific context of the problem at hand. (There are other common statistics that are also suggested that aren’t mentioned above)</p>
<p><a href="https://illustrated-machine-learning.github.io/#/machine-learning/metrics" class="uri">https://illustrated-machine-learning.github.io/#/machine-learning/metrics</a></p>
<p><a href="https://www.researchgate.net/publication/344419928_Introduction_to_Machine_Learning_Neural_Networks_and_Deep_Learning" class="uri">https://www.researchgate.net/publication/344419928_Introduction_to_Machine_Learning_Neural_Networks_and_Deep_Learning</a></p>
<p><img src="sensitivty, specificity.png" class="img-fluid"></p>
</section>
<section id="binomial-example" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="binomial-example"><span class="header-section-number">6.8</span> Binomial example</h2>
<p>Below we will use a <strong>penalized regression</strong> model to predict Wins vs Losses over a quarter. Penalized regression can be thought of as similar to a linear model, but with a penalty applied to the size of the coefficients. There are various ways this penalty can be applied, but here we’ll explore the <strong>L1 penalty</strong>, also known as <strong>LASSO (Least Absolute Shrinkage and Selection Operator)</strong> regression.</p>
<p>The LASSO penalty penalizes the absolute sum of all the coefficients. It has the added benefit of potentially shrinking parameters that don’t contribute significantly to model performance to exactly zero, which can aid in feature selection.</p>
<p>Mathematically, the LASSO objective function looks like this:</p>
<p>LASSO Objective = (Sum of Squared Errors) + λ * (Sum of |β|)</p>
<p>Where:</p>
<ul>
<li>“Sum of Squared Errors” is the standard objective of ordinary least squares regression</li>
<li>λ (lambda) is the tuning parameter that controls the strength of the penalty</li>
<li>“Sum of |β|” is the sum of the absolute values of the coefficients</li>
</ul>
<p>The first term in the equation is the usual sum of squared residuals that we seek to minimize in ordinary least squares regression. The second term, is the LASSO penalty.</p>
<p>Key points:</p>
<ol type="1">
<li><p>When λ = 0, the penalty term has no effect, and we get the same estimates as ordinary least squares.</p></li>
<li><p>As λ increases, the penalty becomes stronger, and more coefficients are shrunk towards zero.</p></li>
<li><p>Some coefficients may be shrunk exactly to zero, effectively removing those predictors from the model.</p></li>
<li><p>The λ parameter is typically chosen through cross-validation to find the value that minimizes prediction error.</p></li>
</ol>
<p>LASSO is particularly useful when dealing with many predictors, especially when some may be correlated, as it performs both regularization (to prevent overfitting) and feature selection simultaneously.</p>
<p>In the literature, the LASSO (and other variants of penalized regression) tend to perform quite well in a range of scenarios, even when compared to more advanced technique.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>m5binom<span class="ot">&lt;-</span> m5_small[, QWL<span class="sc">:</span><span class="er">=</span><span class="fu">as.factor</span>(<span class="fu">ifelse</span>(Diff.Qtr.Points<span class="sc">&gt;</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                  ]<span class="co">#[,Diff.Qtr.Points:=NULL]</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>m5binom_Tst<span class="ot">&lt;-</span> m5_small_tst[, QWL<span class="sc">:</span><span class="er">=</span><span class="fu">as.factor</span>(<span class="fu">ifelse</span>(Diff.Qtr.Points<span class="sc">&gt;</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                  ]<span class="co">#</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>x     <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(m5binom[,<span class="dv">2</span><span class="sc">:</span><span class="dv">21</span>])</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>x_tst <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(m5binom_Tst[,<span class="dv">2</span><span class="sc">:</span><span class="dv">21</span>])</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>y     <span class="ot">&lt;-</span> m5binom<span class="sc">$</span>QWL</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>y_tst <span class="ot">&lt;-</span> m5binom_Tst<span class="sc">$</span>QWL</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(x,y,<span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nfolds =</span> <span class="dv">10</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type.measure =</span> <span class="st">"auc"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span><span class="dv">1</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">keep =</span> T,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">scale =</span>F,<span class="at">intercept =</span>F)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fin_fint  <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(x,y,<span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">lambda =</span>fit1<span class="sc">$</span>lambda<span class="fl">.1</span>se,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">alpha =</span><span class="dv">1</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">type.measure =</span> <span class="st">"auc"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">scale =</span>F,<span class="at">intercept =</span> F)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit1, <span class="at">s =</span> <span class="st">"lambda.1se"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>21 x 1 sparse Matrix of class "dgCMatrix"
                               s1
(Intercept)           .          
CLEARANCE             .          
CONTESTED_POSSESSION  .          
CONTESTED_MARK        0.024550364
CRUMB                 .          
EFFECTIVE_DISPOSAL    .          
INTERCEPT             .          
HITOUT                .          
KICK_GAIN_METRES      0.320804869
KICK                  0.346023235
MARK                  0.007240451
LOOSE_BALL_GET       -0.032812210
TACKLE                0.265107376
REBOUND_50           -0.117526801
METRES_GAINED_EFF     0.199013932
PLY_PRESS_PTS        -0.421942735
SPOIL                -0.066702894
RATING                1.314397272
LONG_KICK             .          
SHORT_KICK            .          
FIRST_POSSESSION      .          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assess.glmnet</span>(fin_fint, <span class="at">newx =</span> x_tst, <span class="at">newy =</span> y_tst,<span class="at">family =</span> <span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$deviance
       s0 
0.8440399 
attr(,"measure")
[1] "Binomial Deviance"

$class
       s0 
0.2042889 
attr(,"measure")
[1] "Misclassification Error"

$auc
[1] 0.8921874
attr(,"measure")
[1] "AUC"

$mse
       s0 
0.2722072 
attr(,"measure")
[1] "Mean-Squared Error"

$mae
       s0 
0.5887983 
attr(,"measure")
[1] "Mean Absolute Error"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>rocs <span class="ot">&lt;-</span> <span class="fu">roc.glmnet</span>(fit1<span class="sc">$</span>fit.preval, <span class="at">newy =</span> y)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>best <span class="ot">&lt;-</span>fit1<span class="sc">$</span>index[<span class="st">"1se"</span>,]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rocs[[best]], <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">sapply</span>(rocs, lines, <span class="at">col=</span><span class="st">"grey"</span>))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(rocs[[best]], <span class="at">lwd =</span> <span class="dv">2</span>,<span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>,<span class="at">b=</span><span class="dv">1</span>,<span class="at">lwd=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To understand the AUC measure of 0.89 it effectively means that if we randomly selected a goal or a miss there is a 0.89% chance that the model would give a higher probability of goal to the goal case. So in a manner this number represents how well our model does at discriminating between cases.</p>
<p>The AUC of the ROC curve is a useful statistic for evaluating model performance. However, in situations with high class imbalance, such as injury prediction where injuries are rare events, it can suggest overly optimistic model performance. This is particularly problematic because most injury models have relatively poor sensitivity (ability to correctly identify actual injuries). The AUC ROC might still appear high due to the model’s ability to correctly classify the numerous non-injury cases, even when its performance in detecting the rare injury cases is limited. This can lead to an overly optimistic interpretation of the model’s practical utility in identifying injuries. For cases like this, a precision-recall graph (which has a higher focus on the minority class) can be useful along with analyzing F1 scores, balanced Accuracy and Cohens Kappa).</p>
<p>We will use a helpful function from the Caret package which has many of these additional statistics. <a href="https://rdrr.io/cran/caret/man/confusionMatrix.html" class="uri">https://rdrr.io/cran/caret/man/confusionMatrix.html</a>,</p>
<p>Whilst, this is very helpful, be sure to read the documentation as it defaults to the first class being the positive class e.g.&nbsp;0 being considered Goal where we obviously want the opposite. (This confused me for like 2 days for a study I did a while a go)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(y_tst,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as.factor</span>(<span class="fu">predict</span>(fin_fint,<span class="at">newx =</span> x_tst,<span class="at">type =</span> <span class="st">"class"</span>)),</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">positive =</span> <span class="st">"1"</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">mode =</span> <span class="st">"everything"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 333 109
         1  72 372
                                          
               Accuracy : 0.7957          
                 95% CI : (0.7676, 0.8218)
    No Information Rate : 0.5429          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.5913          
                                          
 Mcnemar's Test P-Value : 0.007454        
                                          
            Sensitivity : 0.7734          
            Specificity : 0.8222          
         Pos Pred Value : 0.8378          
         Neg Pred Value : 0.7534          
              Precision : 0.8378          
                 Recall : 0.7734          
                     F1 : 0.8043          
             Prevalence : 0.5429          
         Detection Rate : 0.4199          
   Detection Prevalence : 0.5011          
      Balanced Accuracy : 0.7978          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p><strong>Brier Score</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BrierScore</span>(<span class="fu">predict</span>(fin_fint,<span class="at">newx =</span> x_tst,<span class="at">type =</span> <span class="st">"response"</span>),<span class="fu">as.numeric</span>(y_tst)<span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2943991</code></pre>
</div>
</div>
<p><strong>Calibration Curve</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>calPerf <span class="ot">=</span> <span class="fu">val.prob.ci.2</span>(<span class="fu">predict</span>(fin_fint,<span class="at">newx =</span> x_tst,<span class="at">type =</span> <span class="st">"response"</span>), <span class="fu">as.numeric</span>(y_tst)<span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="feature-selection---l1" class="level2" data-number="6.9">
<h2 data-number="6.9" class="anchored" data-anchor-id="feature-selection---l1"><span class="header-section-number">6.9</span> Feature selection - L1</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>m5binom<span class="ot">&lt;-</span> m5_small[, QWL<span class="sc">:</span><span class="er">=</span><span class="fu">as.factor</span>(<span class="fu">ifelse</span>(Diff.Qtr.Points<span class="sc">&gt;</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                  ]<span class="co">#[,Diff.Qtr.Points:=NULL]</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>m5binom_Tst<span class="ot">&lt;-</span> m5_small_tst[, QWL<span class="sc">:</span><span class="er">=</span><span class="fu">as.factor</span>(<span class="fu">ifelse</span>(Diff.Qtr.Points<span class="sc">&gt;</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                  ]<span class="co">#</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>x     <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(m5binom[,<span class="dv">2</span><span class="sc">:</span><span class="dv">21</span>])</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>x_tst <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(m5binom_Tst[,<span class="dv">2</span><span class="sc">:</span><span class="dv">21</span>])</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>y     <span class="ot">&lt;-</span> m5binom<span class="sc">$</span>Diff.Qtr.Points</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>y_tst <span class="ot">&lt;-</span> m5binom_Tst<span class="sc">$</span>Diff.Qtr.Points</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(x,y,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>                  <span class="co">#family = "binomial",</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nfolds =</span> <span class="dv">10</span>,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type.measure =</span> <span class="st">"mae"</span>,</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span><span class="dv">1</span>,</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">keep =</span> T,</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">scale =</span>F,<span class="at">intercept =</span>F)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#fin_fint  &lt;- glmnet(x,y,family = "binomial",</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                    lambda =fit1$lambda.1se,</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                    alpha =1,</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                    type.measure = "auc",</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                    scale =F,intercept = F)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit2, <span class="at">s =</span> <span class="st">"lambda.1se"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>21 x 1 sparse Matrix of class "dgCMatrix"
                              s1
(Intercept)           .         
CLEARANCE             .         
CONTESTED_POSSESSION  .         
CONTESTED_MARK        0.12882920
CRUMB                 .         
EFFECTIVE_DISPOSAL    .         
INTERCEPT             .         
HITOUT                .         
KICK_GAIN_METRES      1.96561681
KICK                  2.51050179
MARK                  .         
LOOSE_BALL_GET       -0.13742292
TACKLE                2.94222473
REBOUND_50           -1.06358316
METRES_GAINED_EFF     1.82694544
PLY_PRESS_PTS        -3.76403791
SPOIL                -0.67890923
RATING                8.27345169
LONG_KICK             .         
SHORT_KICK            0.02990906
FIRST_POSSESSION      .         </code></pre>
</div>
</div>
<p>When attempting to utilise feature selection algorithms, I usually suggest penalization methods such as LASSO (Least Absolute Shrinkage and Selection Operator). These techniques offer several advantages over alternative methods, particularly in handling multicollinearity and producing sparse, interpretable models. However, it’s important to acknowledge that penalization approaches are not without limitations.</p>
<p>One key consideration is that penalized models may yield coefficient estimates that differ from what we might expect based on univariate analyses. This divergence highlights the complex, multidimensional nature of relationships within our data and underscores the importance of a comprehensive approach to feature selection.</p>
<p>To enhance model interpretability and stability, it’s crucial to identify and potentially remove redundant variables or those that are nearly perfectly explained by a combination of other variables. Such variables can introduce confounding effects and obscure the interpretability of our model. This process often requires a balance between statistical techniques and domain expertise.</p>
<p>To address these challenges, we’ll explore unsupervised learning approaches to identify variables that are highly related in multidimensional space. Techniques such as Principal Component Analysis (PCA), t-SNE (t-Distributed Stochastic Neighbor Embedding), or UMAP (Uniform Manifold Approximation and Projection) can reveal non-obvious relationships between variables that might not be apparent from simple correlation matrices.</p>
<p>The data preprocessing steps we took earlier, including log transformation and scaling, are particularly relevant for these unsupervised methods. By transforming variables from different distributions to a roughly consistent log-normal distribution, we create a more suitable input for many unsupervised algorithms, which often assume normally distributed data.</p>
<p>It’s important to note that feature selection is typically an iterative process. We may cycle between penalization methods, unsupervised techniques, and domain knowledge-based selection to refine our feature set. Throughout this process, we’ll need to balance model complexity (number of features) with performance, considering the bias-variance tradeoff</p>
</section>
<section id="feature-selection---alternate-methods" class="level2" data-number="6.10">
<h2 data-number="6.10" class="anchored" data-anchor-id="feature-selection---alternate-methods"><span class="header-section-number">6.10</span> Feature selection - Alternate methods</h2>
<p>Probably one of the most commonly used algorithms for reducing the amount of variables is principle component analysis (PCA). I won;t get into too much detail into the algorithm as there are many resources available online that do a great job at explaining what PCA is trying to achieve.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>data.pca <span class="ot">&lt;-</span> <span class="fu">princomp</span>(x)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_eig</span>(data.pca, <span class="at">addlabels =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(data.pca<span class="sc">$</span>loadings[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     Comp.1 Comp.2 Comp.3 Comp.4
CLEARANCE             0.064  0.331  0.415  0.097
CONTESTED_POSSESSION  0.224  0.364  0.003  0.175
CONTESTED_MARK        0.133 -0.067  0.047  0.097
CRUMB                 0.150  0.151 -0.279  0.276
EFFECTIVE_DISPOSAL    0.352 -0.130  0.094 -0.082
INTERCEPT             0.206  0.097 -0.385 -0.023
HITOUT               -0.045  0.221  0.237 -0.186
KICK_GAIN_METRES      0.380  0.072 -0.077  0.021
KICK                  0.381 -0.118  0.048 -0.119
MARK                  0.239 -0.357  0.112 -0.173
LOOSE_BALL_GET        0.166  0.309 -0.169  0.202
TACKLE               -0.032  0.280  0.024 -0.575
REBOUND_50           -0.038 -0.011 -0.386 -0.146
METRES_GAINED_EFF     0.348 -0.028 -0.040 -0.077
PLY_PRESS_PTS        -0.055  0.257 -0.144 -0.594
SPOIL                 0.016  0.176 -0.295 -0.005
RATING                0.345  0.132  0.134 -0.029
LONG_KICK             0.221  0.120 -0.120 -0.028
SHORT_KICK            0.259 -0.317  0.162 -0.172
FIRST_POSSESSION      0.031  0.324  0.408  0.076</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_pca_var</span>(data.pca, <span class="at">col.var =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_cos2</span>(data.pca, <span class="at">choice =</span> <span class="st">"var"</span>, <span class="at">axes =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_pca_var</span>(data.pca, <span class="at">col.var =</span> <span class="st">"cos2"</span>,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">gradient.cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"orange"</span>, <span class="st">"green"</span>),</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">repel =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="sparce-pca" class="level4" data-number="6.10.0.1">
<h4 data-number="6.10.0.1" class="anchored" data-anchor-id="sparce-pca"><span class="header-section-number">6.10.0.1</span> Sparce PCA</h4>
<p><a href="https://mixomicsteam.github.io/mixOmics-Vignette/index.html" class="uri">https://mixomicsteam.github.io/mixOmics-Vignette/index.html</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mixOmics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MASS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:patchwork':

    area</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Loaded mixOmics 6.26.0
Thank you for using mixOmics!
Tutorials: http://mixomics.org
Bookdown vignette: https://mixomicsteam.github.io/Bookdown
Questions, issues: Follow the prompts at http://mixomics.org/contact-us
Cite us:  citation('mixOmics')</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'mixOmics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:caret':

    nearZeroVar, plsda, splsda</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    map</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>grid.keepX <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">20</span>, <span class="dv">5</span>))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">30</span>) <span class="co"># For reproducibility</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>tune.spca.result <span class="ot">&lt;-</span> <span class="fu">tune.spca</span>(x,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ncomp =</span> <span class="dv">5</span>, </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">folds =</span> <span class="dv">5</span>, </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">test.keepX =</span> grid.keepX, <span class="at">nrepeat =</span> <span class="dv">10</span>) </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tune.spca.result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>keepX.select <span class="ot">&lt;-</span> tune.spca.result<span class="sc">$</span>choice.keepX[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>sparse_res <span class="ot">&lt;-</span>mixOmics<span class="sc">::</span><span class="fu">spca</span>(x,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">ncomp =</span> <span class="dv">3</span>, </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#keepX=c(4,4,4),</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">center =</span> F,<span class="at">scale =</span> F,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">keepX =</span> keepX.select)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVar</span>(sparse_res,<span class="at">cex =</span> <span class="dv">3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLoadings</span>(sparse_res, <span class="at">comp =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLoadings</span>(sparse_res, <span class="at">comp =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-25-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLoadings</span>(sparse_res, <span class="at">comp =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-25-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#par(mfrow = c(1, 1))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="feature-selection---gam" class="level2" data-number="6.11">
<h2 data-number="6.11" class="anchored" data-anchor-id="feature-selection---gam"><span class="header-section-number">6.11</span> Feature selection - GAM</h2>
<p>To finish of with we will also explore feature selection utilizing my modelling package, gams withing the MGCV package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>m5_raw <span class="ot">&lt;-</span> m5_dat[,.(Diff.Qtr.Points,CLEARANCE,CONTESTED_POSSESSION,CONTESTED_MARK,CRUMB,EFFECTIVE_DISPOSAL,INTERCEPT,HITOUT,KICK_GAIN_METRES,KICK,MARK,LOOSE_BALL_GET,TACKLE,REBOUND_50,METRES_GAINED_EFF,PLY_PRESS_PTS,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>SPOIL,RATING,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>LONG_KICK,SHORT_KICK,FIRST_POSSESSION)]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">names</span>(m5_raw[,<span class="dv">2</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>smooth_terms <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"s("</span>, predictors, <span class="st">")"</span>, <span class="at">collapse =</span> <span class="st">" + "</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="do">## could add random effects to this as well if you wanted eg</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co"># s(SQUAD_NAME,bs="re")</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">&lt;-</span> <span class="fu">reformulate</span>(<span class="fu">c</span>(smooth_terms), <span class="at">response =</span> <span class="st">"Diff.Qtr.Points"</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>m1_gam <span class="ot">&lt;-</span> <span class="fu">bam</span>(formula, </span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> m5_raw,</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">discrete =</span> T,</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">select =</span> T,</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">method =</span> <span class="st">"fREML"</span>)</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>sm_gam <span class="ot">&lt;-</span><span class="fu">summary</span>(m1_gam)</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="do">## only keey relatively high F values, could go based of pvalues as well</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(sm_gam<span class="sc">$</span>s.table,<span class="dv">2</span>)<span class="sc">|&gt;</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>()<span class="sc">|&gt;</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">i=</span><span class="fu">row_number</span>())<span class="sc">|&gt;</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(F<span class="sc">&gt;=</span><span class="fl">1.5</span>)<span class="sc">|&gt;</span></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">"i"</span>,<span class="st">"edf"</span>,<span class="st">"F"</span>,<span class="st">"p.value"</span>)<span class="sc">|&gt;</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>  htmlTable<span class="sc">::</span><span class="fu">htmlTable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="gmisc_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; border-bottom: 1px solid grey; border-top: 2px solid grey;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">i</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">edf</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">F</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">s(EFFECTIVE_DISPOSAL)</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">2.17</td>
<td style="text-align: center;">5.92</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">s(KICK_GAIN_METRES)</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">3.82</td>
<td style="text-align: center;">7.38</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">s(KICK)</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">0.96</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">s(LOOSE_BALL_GET)</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">2.71</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">s(TACKLE)</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">31.07</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">s(REBOUND_50)</td>
<td style="text-align: center;">13</td>
<td style="text-align: center;">2.95</td>
<td style="text-align: center;">3.09</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">s(METRES_GAINED_EFF)</td>
<td style="text-align: center;">14</td>
<td style="text-align: center;">0.98</td>
<td style="text-align: center;">4.92</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">s(PLY_PRESS_PTS)</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">3.36</td>
<td style="text-align: center;">46.82</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">s(RATING)</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">3.04</td>
<td style="text-align: center;">129.17</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; border-bottom: 2px solid grey;">s(SHORT_KICK)</td>
<td style="text-align: center; border-bottom: 2px solid grey;">19</td>
<td style="text-align: center; border-bottom: 2px solid grey;">2.75</td>
<td style="text-align: center; border-bottom: 2px solid grey;">1.82</td>
<td style="text-align: center; border-bottom: 2px solid grey;">0</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#par(mar=c(1,1,1,1))</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m1_gam,<span class="at">shade.col =</span> <span class="st">"gray70"</span>,<span class="at">select =</span> <span class="dv">14</span>,<span class="at">shade =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module5_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./module4.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Module 4</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">references.html</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>