<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GWS Data Science and Problem Recognition - 4&nbsp; Module 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./module4.html" rel="next">
<link href="./module2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./module3.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Module 3</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GWS Data Science and Problem Recognition</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Module 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Module 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Module 3</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Module 4</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Module 5</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">references.html</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#recap-from-last-week" id="toc-recap-from-last-week" class="nav-link active" data-scroll-target="#recap-from-last-week"><span class="header-section-number">4.1</span> Recap from last week</a></li>
  <li><a href="#goals-for-this-week." id="toc-goals-for-this-week." class="nav-link" data-scroll-target="#goals-for-this-week."><span class="header-section-number">4.2</span> Goals for this week.</a></li>
  <li><a href="#load-data-and-packages" id="toc-load-data-and-packages" class="nav-link" data-scroll-target="#load-data-and-packages"><span class="header-section-number">4.3</span> Load data and packages</a></li>
  <li><a href="#basic-probability-and-distributions" id="toc-basic-probability-and-distributions" class="nav-link" data-scroll-target="#basic-probability-and-distributions"><span class="header-section-number">4.4</span> Basic probability and distributions</a></li>
  <li><a href="#generalized-linear-models" id="toc-generalized-linear-models" class="nav-link" data-scroll-target="#generalized-linear-models"><span class="header-section-number">4.5</span> Generalized Linear models</a>
  <ul class="collapse">
  <li><a href="#gaussian-example" id="toc-gaussian-example" class="nav-link" data-scroll-target="#gaussian-example"><span class="header-section-number">4.5.1</span> <strong>Gaussian example</strong></a></li>
  <li><a href="#binomial-example." id="toc-binomial-example." class="nav-link" data-scroll-target="#binomial-example."><span class="header-section-number">4.5.2</span> <strong>Binomial example.</strong></a></li>
  <li><a href="#poisson-example" id="toc-poisson-example" class="nav-link" data-scroll-target="#poisson-example"><span class="header-section-number">4.5.3</span> Poisson Example</a></li>
  </ul></li>
  <li><a href="#binomial-example-xg-model" id="toc-binomial-example-xg-model" class="nav-link" data-scroll-target="#binomial-example-xg-model"><span class="header-section-number">4.6</span> Binomial Example / xG model</a></li>
  <li><a href="#assess-our-first-xg-model" id="toc-assess-our-first-xg-model" class="nav-link" data-scroll-target="#assess-our-first-xg-model"><span class="header-section-number">4.7</span> Assess our first xG model</a></li>
  <li><a href="#circling-back" id="toc-circling-back" class="nav-link" data-scroll-target="#circling-back"><span class="header-section-number">4.8</span> Circling back</a>
  <ul class="collapse">
  <li><a href="#key-assumptions-to-consider" id="toc-key-assumptions-to-consider" class="nav-link" data-scroll-target="#key-assumptions-to-consider"><span class="header-section-number">4.8.1</span> Key Assumptions to Consider</a></li>
  <li><a href="#practical-steps" id="toc-practical-steps" class="nav-link" data-scroll-target="#practical-steps"><span class="header-section-number">4.8.2</span> Practical Steps</a></li>
  </ul></li>
  <li><a href="#final-models" id="toc-final-models" class="nav-link" data-scroll-target="#final-models"><span class="header-section-number">4.9</span> Final Models</a>
  <ul class="collapse">
  <li><a href="#poisson-model" id="toc-poisson-model" class="nav-link" data-scroll-target="#poisson-model"><span class="header-section-number">4.9.1</span> Poisson model</a></li>
  <li><a href="#multinominial" id="toc-multinominial" class="nav-link" data-scroll-target="#multinominial"><span class="header-section-number">4.9.2</span> Multinominial</a></li>
  </ul></li>
  <li><a href="#what-we-didnt-get-time-to-explore" id="toc-what-we-didnt-get-time-to-explore" class="nav-link" data-scroll-target="#what-we-didnt-get-time-to-explore"><span class="header-section-number">4.10</span> What we didn’t get time to explore</a></li>
  <li><a href="#next-module" id="toc-next-module" class="nav-link" data-scroll-target="#next-module"><span class="header-section-number">4.11</span> Next module</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Module 3</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="recap-from-last-week" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="recap-from-last-week"><span class="header-section-number">4.1</span> Recap from last week</h2>
<ol type="1">
<li><p>What is the difference between supervised and unsupervised learning?</p></li>
<li><p>If I was to try predict a category or a class, what type of prediction problem would this be considered?</p></li>
<li><p>What are the benefits of developing a mini DAG or casual structure?</p></li>
</ol>
</section>
<section id="goals-for-this-week." class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="goals-for-this-week."><span class="header-section-number">4.2</span> Goals for this week.</h2>
<ol type="1">
<li><p>Introduction into R programming language and getting started with some descriptive statistics.</p></li>
<li><p>Understanding key terms; Exploratory analysis, Supervised vs Unsupervised problems, regression vs classification, prediction vs association.</p></li>
<li><p><strong>A quick note on distributions - Supervised regression and classification problems using a generalized linear model framework. (Hypothesis testing)</strong></p></li>
<li><p>Machine learning approach to Supervised learning</p></li>
</ol>
<p>The below is an exert from a book that I have stolen that I think does a great job a summarizing the goal of statistical modelling.</p>
<p>“Almost every statistical analysis begins with some kind of statistical model. A statistical model generally takes the form of a <strong>probability distribution</strong> that attempts to quantify the uncertainty that comes with observing a new response. The model is intended to represent the unknown phenomenon that governs the observation process. At the same time, the model needs to be convenient to work with mathematically, so that inference procedures such as confidence intervals and <strong>hypothesis tests</strong> can be developed. Selecting a model is typically a compromise between two competing goals: providing a more detailed approximation to the process that generates the data and providing inference procedures that are easy to use.”</p>
<p>pg1, Analysis of Categorical data with R Christopher R. Bilder and Thomas M Loughin. 2015.</p>
<p>This book also seems to be freely available from a google search.</p>
<p><a href="http://ndl.ethernet.edu.et/bitstream/123456789/28010/1/Christopher%20R.%20Bilder_2015.pdf" class="uri">http://ndl.ethernet.edu.et/bitstream/123456789/28010/1/Christopher%20R.%20Bilder_2015.pdf</a></p>
</section>
<section id="load-data-and-packages" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="load-data-and-packages"><span class="header-section-number">4.3</span> Load data and packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(data.table,tidyverse,htmlTable,ggforce,ggpubr,ggeffects,lme4,emmeans,mgcv,performance,nnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>urlfile<span class="ot">=</span><span class="st">"https://raw.githubusercontent.com/R2mu/GWS_DSPR/main/data/mod2data.csv"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">fread</span>(urlfile)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>urlfile2<span class="ot">=</span><span class="st">"https://raw.githubusercontent.com/R2mu/GWS_DSPR/main/data/shotdata.csv"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">fread</span>(urlfile2)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> data2<span class="sc">|&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Rotated.xStd=</span>shots.details.locationRotated.xStd,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Rotated.yStd=</span>shots.details.locationRotated.yStd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="basic-probability-and-distributions" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="basic-probability-and-distributions"><span class="header-section-number">4.4</span> Basic probability and distributions</h2>
<p>We are going to explore the idea of modelling a probability distribution today. Now there are many different varieties of probability distributions that exist, but we will just explore a couple of them that I from my experience will cover the largest chunk of questions you may be interested in asking in sport.</p>
<p>1) <strong>The normal distribution</strong>, often referred to as the bell curve, is appropriate for many situations involving continuous data. It is characterized by its symmetric shape, where most of the observations cluster around the mean, and the probabilities for values taper off equally on both sides. This distribution is particularly suitable for variables such as score differential, meters gained, and other player statistics with high means.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>2) Binomial Distribution:</strong> The binomial distribution is ideal for modeling the number of successes in a fixed number of independent trials, where each trial has two possible outcomes (success or failure) and a constant probability of success. It is particularly useful for scenarios where you are counting the number of times an event occurs, such as the number of goals scored by a player in a series of attempts, or the number of games won in a season. The binomial distribution is defined by two parameters: the number of trials (n) and the probability of success (p). It helps in situations where the outcomes are discrete and the trials are independent, allowing for the calculation of probabilities for different numbers of successes.</p>
<p>Lets say for example you wanted the model probability of Toby Greene kicking 4 goals from 5 attempts in a game.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">4</span> <span class="co"># represents number of GOALS </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">5</span> <span class="co"># From 5 attempts </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fl">0.57</span> <span class="co"># with a baseline probability per attempt of 0.57</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">dbinom</span>(x,n,p),<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.23</code></pre>
</div>
</div>
<p>This means that, under these conditions, there is a 23% chance that Toby will achieve 4 successful goals in 5 attempts.</p>
<p>If we wanted to plot all the outcomes e.g 1 from 5, 2 from 5 etc etc it would look like the below</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>binom_prob <span class="ot">=</span> <span class="fu">dbinom</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">5</span>,<span class="fl">0.57</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>, binom_prob, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Number of Goals"</span>, <span class="at">ylab =</span> <span class="st">"Probability"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Binomial Distribution of number of goals from 5 attempts"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>, binom_prob, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>3)</strong> <strong>The Poisson distribution:</strong> is appropriate for modelling the number of events occurring within a fixed interval of time or space, particularly when these events are rare or infrequent. It is often used for count data where the mean number of occurrences is low, such as the number of goals scored in a single match by a player, the number of customer arrivals in an hour, or the number of system failures in a day. The Poisson distribution is defined by a single parameter (λ), which represents both the mean and the variance of the distribution. In my experience this assumption regarding the mean and variance is often violated so other parameters can be introduced to the assumption to deal with it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>g1<span class="ot">=</span> <span class="fu">ggplot</span>(data1,<span class="fu">aes</span>(TACKLE))<span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_histogram</span>(<span class="at">col=</span><span class="st">"white"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">=</span><span class="fu">ggplot</span>(data1,<span class="fu">aes</span>(CONTESTED_POSSESSION))<span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_histogram</span>(<span class="at">col=</span><span class="st">"white"</span>,<span class="at">binwidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(g1,g2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="generalized-linear-models" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="generalized-linear-models"><span class="header-section-number">4.5</span> Generalized Linear models</h2>
<section id="gaussian-example" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="gaussian-example"><span class="header-section-number">4.5.1</span> <strong>Gaussian example</strong></h3>
<p>Now the we’ve had a look at some distributions we are going to have a look at some methods for modelling different distributions. In week 1 we modeled how well a simple linear regression model could predict score differential. Mathematically, a linear regression model can be thought of as saying a prediction of Score differential is Normally distributed with some <strong>mean</strong> <span class="math inline">\(\mu\)</span> and <strong>standard deviation</strong> <span class="math inline">\(\sigma\)</span> .</p>
<p><span class="math inline">\(\text{Score differential} \sim \text{Normal}(\mu_i,\sigma)\)</span></p>
<p>Where the mean can be described by a linear equation</p>
<p><span class="math inline">\(\mu_i = \alpha+\beta_1 X_1+\beta2 X_2\)</span>.</p>
<p>Now this might look a little scary but this effectively just <strong>y = mx+b</strong> that you have learnt in high school, except in this case <span class="math inline">\(X_1\)</span> might represent inside 50s and <span class="math inline">\(X_2\)</span> might represent disposals. Since we have two variables this is a multiple regression model.</p>
<p>The figure below hopefully helps make this idea that a prediction can be thought of as a sample from the normal distribution with a conditional effect based on the predictor variable</p>
<p><img src="normalOverlay.png" class="img-fluid"></p>
</section>
<section id="binomial-example." class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="binomial-example."><span class="header-section-number">4.5.2</span> <strong>Binomial example.</strong></h3>
<p>Lets go back to our binomial probability example we were talking about before. We might say something like the probability of scoring a goal is binomially distributed with some probability <span class="math inline">\(p_i\)</span>.</p>
<p><span class="math inline">\(\text{Goal success} \sim \text{Binomial}(1,p_i)\)</span></p>
<p>The issue we have here is that <span class="math inline">\(p_i\)</span> which represents the probability success, is obviously going to be impacted by things such as distance from goal, angle from goal and whether it was during play or a set shot. So what we are interested in doing is estimated how this probability <span class="math inline">\(p_i\)</span> will change as a function of those variables, which we do in the same manner we estimated the mean in the linear regression model above.</p>
<p><span class="math inline">\(logit(p_i) = \alpha +\beta_1 X_1+\beta2 X_2\)</span></p>
<p>You can think of <span class="math inline">\(B_1\)</span> as maybe distance from goal and <span class="math inline">\(B_2\)</span> as angle from goal possibly. The other thing you may notice is that the <span class="math inline">\(p_1\)</span> has been wrapped in a <strong>logit</strong> function. This is one example of the super power of generalized linear models. Effectively, we are able to keep the same notation as we would for a simple linear model, but we transform this linear combination to make sure that the result stays between 0 and 1 or Miss and GOAL in our example. This logit (logistic) function is why you will often here modelling 0 and 1s as logistic regression.</p>
</section>
<section id="poisson-example" class="level3" data-number="4.5.3">
<h3 data-number="4.5.3" class="anchored" data-anchor-id="poisson-example"><span class="header-section-number">4.5.3</span> Poisson Example</h3>
<p>If we were modeling a count or something that fits a Poisson distribution, the transformation would be:</p>
<p><span class="math inline">\(log(\lambda) = \alpha +\beta_1 X_1+\beta2 X_2\)</span></p>
<p>This time <span class="math inline">\(log(\lambda)\)</span> would transform the linear predictors to be constrained to match the poisson distribution. It should be noted that Poisson distributions can be a little more tricky to deal with, as there are some other parameters to consider tuning which relate to dispersion etc. These are more advanced topics and outside the scope of this practical.</p>
</section>
</section>
<section id="binomial-example-xg-model" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="binomial-example-xg-model"><span class="header-section-number">4.6</span> Binomial Example / xG model</h2>
<p>Okay so now we have got past the theory, lets delve into some examples. Our first example is going to be developing our own expected Goals/Points models which can be just simply thought of as a binomial/logistic regression model. We will use information related to shot location and shots detail (General play, Set shot etc) to predict the probability of a goal being scored.</p>
<p>First things first, lets do some quick data cleaning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>shot_small <span class="ot">&lt;-</span> data2<span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Rotated.xStd<span class="sc">&gt;</span>(<span class="sc">-</span><span class="dv">20</span>))<span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Shot_outcome =</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(shots.result.code<span class="sc">==</span><span class="st">"G"</span>,<span class="dv">1</span>,<span class="dv">0</span>)),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Champ_Xp_err =</span> <span class="fu">round</span>(shots.result.points<span class="sc">-</span>shots.result.pointsExpected,<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ellipse</span>(<span class="fu">aes</span>(<span class="at">x0 =</span> <span class="dv">0</span>, <span class="at">y0 =</span> <span class="dv">0</span>, <span class="at">a =</span> <span class="dv">80</span>, <span class="at">b =</span> <span class="dv">70</span>, <span class="at">angle =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>(shot_small, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">mapping=</span> <span class="fu">aes</span>(<span class="at">x=</span>Rotated.xStd,<span class="at">y=</span>Rotated.yStd),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">bins=</span><span class="dv">30</span>)<span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(shot_small,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>Rotated.xStd,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span>Rotated.yStd,<span class="at">col=</span>shots.result.code))<span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density2d</span>(<span class="at">col=</span><span class="st">"gray90"</span>)<span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Lets have a quick look at how well the champion data expected points model does.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>MAE <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">abs</span>(shot_small<span class="sc">$</span>Champ_Xp_err))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(shot_small,<span class="fu">aes</span>(<span class="fu">abs</span>(Champ_Xp_err)))<span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_histogram(col="white")+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Campion xG error ="</span>, <span class="fu">round</span>(MAE,<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">"gray80"</span>)<span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Before we look to build our first model. Lets do some simple <strong>exploratory statistics</strong> of some of the parameters we will likely end up including in our model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>shot_small<span class="sc">|&gt;</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="dv">80</span><span class="sc">-</span>Rotated.xStd,<span class="at">x=</span>Shot_outcome,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> shots.details.type))<span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">height =</span> .<span class="dv">1</span>,<span class="at">alpha=</span>.<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width=</span>.<span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>shots.details.type,<span class="at">ncol =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Not the best looking plot, but in general we can a small impact of the closer we are to the goals in x_direction the more likely we are to score a goal. Lets try model this along with the y component.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Shot_outcome<span class="sc">~</span>Rotated.xStd<span class="sc">+</span>Rotated.yStd,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> shot_small,<span class="at">family =</span> binomial)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">=</span><span class="fu">summary</span>(m1)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(s<span class="sc">$</span>coefficients,<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)    -1.197      0.081 -14.701        0
Rotated.xStd    0.022      0.002  14.196        0
Rotated.yStd    0.004      0.001   4.949        0</code></pre>
</div>
</div>
<p>Now lets spend a little bit of time thinking about what the above means. We will focus our time on the Estimate column. Now a logistic regression model returns coefficients (Estimate) on the log odds scale. So currently, if we focus on <strong>Rotated.xStd</strong> with its estimate of 0.022, this would mean as we get 1 metre closer to the goal holding all other variables constant our log odds of success increases by 0.022. If you still have no idea what that means, that’s okay—you are in the right place. It is often easier to understand if we convert log-odds to what are called odds ratios. We will do this below</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="fu">round</span>(<span class="fu">exp</span>(<span class="fu">coef</span>(m1)),<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             round.exp.coef.m1....3.
(Intercept)                    0.302
Rotated.xStd                   1.022
Rotated.yStd                   1.004</code></pre>
</div>
</div>
<p>Now we can say the odds of scoring a goal increase by 2.2% for every meter closer to the goal we get, holding all other variables equal. Keen-eyed readers might notice that the odds ratio and log-odds in this case return effectively identical numbers. Although it’s outside the scope of this module, for small values of the coefficients, both the log-odds and odds ratios will be similar.</p>
<p>However, both log-odds and odds ratios still have limitations in that they only express the relative difference between two scenarios. They do not provide information about how this impacts the absolute risk. This is a much bigger problem in datasets with imbalanced outcomes, such as low rates of injuries versus not injured. For instance, we might say the odds of injury increase by 50% under some condition, but this might only represent an absolute risk increase from 3% to 4.5%.</p>
<p>The easiest way around all this complexity is just to plot or return the values on the probability scale. Lets do this below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>xstd <span class="ot">&lt;-</span> <span class="fu">predict_response</span>(m1, <span class="st">"Rotated.xStd"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>ystd <span class="ot">&lt;-</span> <span class="fu">predict_response</span>(m1, <span class="st">"Rotated.yStd"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>p1   <span class="ot">&lt;-</span> <span class="fu">plot</span>(xstd,<span class="at">show_data =</span> T,<span class="at">jitter =</span> <span class="fl">0.1</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>p2   <span class="ot">&lt;-</span> <span class="fu">plot</span>(ystd,<span class="at">show_data =</span> T,<span class="at">jitter =</span> <span class="fl">0.1</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p1,p2,<span class="at">common.legend =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see the effects above but if you wanted to be more explicit about contrasting the impacts, you could do something like the below</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>em1 <span class="ot">=</span><span class="fu">emmeans</span>(m1,<span class="sc">~</span>Rotated.xStd,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">at =</span> <span class="fu">list</span>(<span class="at">Rotated.xStd =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">50</span>)),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(em1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Rotated.xStd  prob      SE  df asymp.LCL asymp.UCL
           25 0.343 0.01012 Inf     0.323     0.363
           50 0.474 0.00486 Inf     0.464     0.483

Confidence level used: 0.95 
Intervals are back-transformed from the logit scale </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>em1 <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">regrid</span>()<span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairs</span>()<span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>()<span class="sc">|&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(contrast,estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         contrast   estimate
1 Rotated.xStd25 - Rotated.xStd50 -0.1312767</code></pre>
</div>
</div>
</section>
<section id="assess-our-first-xg-model" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="assess-our-first-xg-model"><span class="header-section-number">4.7</span> Assess our first xG model</h2>
<p>To do this we are going to predict our model response to the data.frame and multiple that number by 6.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>shot_small <span class="ot">&lt;-</span> shot_small<span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xG_m1 =</span> <span class="fu">predict</span>(m1,<span class="at">type=</span><span class="st">"response"</span>)<span class="sc">*</span><span class="dv">6</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">m1_Xp_err =</span> <span class="fu">round</span>(shots.result.points<span class="sc">-</span>xG_m1,<span class="dv">3</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>MAE_champ  <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">abs</span>(shot_small<span class="sc">$</span>Champ_Xp_err))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>MAE_m1     <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">abs</span>(shot_small<span class="sc">$</span>m1_Xp_err))</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(shot_small,<span class="fu">aes</span>(<span class="fu">abs</span>(Champ_Xp_err)))<span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_histogram(col="white")+</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"MAE_champ ="</span>,<span class="fu">round</span>(MAE_champ,<span class="dv">2</span>),<span class="st">"MAE_m1="</span>,<span class="fu">round</span>(MAE_m1,<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">"gray80"</span>,<span class="at">alpha=</span>.<span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">"blue"</span>,<span class="at">alpha=</span>.<span class="dv">3</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>               shot_small, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="fu">abs</span>(m1_Xp_err)))<span class="sc">+</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Okay so we are slightly better than just flipping a coin on each shot at goal but champion is still a better model at the moment. Lets try one more model and see how we go.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>shot_small<span class="sc">$</span>shots.player.displayName<span class="ot">&lt;-</span><span class="fu">as.factor</span>(shot_small<span class="sc">$</span>shots.player.displayName)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>shot_small<span class="sc">$</span>shots.details.type<span class="ot">&lt;-</span><span class="fu">as.factor</span>(shot_small<span class="sc">$</span>shots.details.type)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">bam</span>(Shot_outcome<span class="sc">~</span><span class="fu">te</span>(Rotated.xStd,Rotated.yStd,<span class="at">by=</span>shots.details.type)<span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">s</span>(shots.player.displayName,<span class="at">bs=</span><span class="st">"re"</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> binomial,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">nthreads=</span><span class="dv">8</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">discrete =</span> T,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> shot_small ,<span class="at">method =</span> <span class="st">"fREML"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(earth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'earth' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Formula</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: plotmo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'plotmo' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: plotrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'plotrix' was built under R version 4.3.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">=</span> earth<span class="sc">::</span><span class="fu">earth</span>(Shot_outcome<span class="sc">~</span>Rotated.xStd<span class="sc">+</span>Rotated.yStd<span class="sc">+</span>shots.details.type,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">degree=</span><span class="dv">2</span>, <span class="at">glm=</span><span class="fu">list</span>(<span class="at">family=</span>binomial),<span class="at">data =</span> shot_small)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m3, <span class="at">which =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>pdp<span class="sc">::</span><span class="fu">partial</span>(m3, <span class="at">pred.var =</span> <span class="st">"Rotated.xStd"</span>,<span class="at">prob =</span><span class="cn">TRUE</span>,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">grid.resolution =</span> <span class="dv">10</span>,) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We won’t bother looking at the coefs for now lets just see if we are getting better performance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>shot_small <span class="ot">&lt;-</span> shot_small<span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xG_m2 =</span> <span class="fu">predict</span>(m2,<span class="at">type=</span><span class="st">"response"</span>)<span class="sc">*</span><span class="dv">6</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">xG_m3 =</span> <span class="fu">predict</span>(m3,<span class="at">type=</span><span class="st">"response"</span>)<span class="sc">*</span><span class="dv">6</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">m2_Xp_err =</span> <span class="fu">round</span>(shots.result.points<span class="sc">-</span>xG_m2,<span class="dv">3</span>),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">m3_Xp_err =</span> <span class="fu">round</span>(shots.result.points<span class="sc">-</span>xG_m3,<span class="dv">3</span>))</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>MAE_m2     <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">abs</span>(shot_small<span class="sc">$</span>m2_Xp_err))</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>MAE_m3     <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">abs</span>(shot_small<span class="sc">$</span>m3_Xp_err))</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(shot_small,<span class="fu">aes</span>(<span class="fu">abs</span>(Champ_Xp_err)))<span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_histogram(col="white")+</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"MAE_champ ="</span>,<span class="fu">round</span>(MAE_champ,<span class="dv">2</span>),<span class="st">"MAE_m1="</span>,<span class="fu">round</span>(MAE_m1,<span class="dv">2</span>),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"MAE_m2="</span>,<span class="fu">round</span>(MAE_m2,<span class="dv">2</span>),</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"MAE_m3="</span>,<span class="fu">round</span>(MAE_m3,<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">"gray80"</span>,<span class="at">alpha=</span>.<span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">"blue"</span>,<span class="at">alpha=</span>.<span class="dv">3</span>,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>               shot_small, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="fu">abs</span>(m1_Xp_err)))<span class="sc">+</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">"red"</span>,<span class="at">alpha=</span>.<span class="dv">3</span>,</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>               shot_small, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="fu">abs</span>(m2_Xp_err)))<span class="sc">+</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">"yellow"</span>,<span class="at">alpha=</span>.<span class="dv">3</span>,</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>               shot_small, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="fu">abs</span>(m3_Xp_err)))<span class="sc">+</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">abs</span>(shot_small<span class="sc">$</span>Champ_Xp_err))<span class="sc">-</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">abs</span>(shot_small<span class="sc">$</span>m2_Xp_err))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 889.98</code></pre>
</div>
</div>
<p>So over the 2013 season our GAM model better identified up 889 points when compared to the champion code.</p>
<p>Lets see if we can better visualize what our final model thinks</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">cex=</span>.<span class="dv">9</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vis.gam</span>(m2, <span class="at">view =</span> <span class="fu">c</span>(<span class="st">"Rotated.xStd"</span>, <span class="st">"Rotated.yStd"</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">cond=</span><span class="fu">list</span>(<span class="at">shots.details.type=</span><span class="st">"Set Shot Regular"</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.type =</span> <span class="st">"contour"</span>, </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"heat"</span>,<span class="at">too.far =</span> <span class="fl">0.1</span>,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">lwd=</span><span class="dv">2</span>,<span class="at">labcex =</span> <span class="fl">0.8</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">contour.col  =</span> <span class="st">"black"</span>,<span class="at">nCol =</span> <span class="dv">20</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"response"</span>,<span class="at">main =</span><span class="st">"Set Shot Regular"</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">vis.gam</span>(m2, <span class="at">view =</span> <span class="fu">c</span>(<span class="st">"Rotated.xStd"</span>, <span class="st">"Rotated.yStd"</span>),</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">cond=</span><span class="fu">list</span>(<span class="at">shots.details.type=</span><span class="st">"Set Shot Snap"</span>),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.type =</span> <span class="st">"contour"</span>, </span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"heat"</span>,<span class="at">too.far =</span> <span class="fl">0.1</span>,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">lwd=</span><span class="dv">2</span>,<span class="at">labcex =</span> <span class="fl">0.8</span>,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">contour.col  =</span> <span class="st">"black"</span>,<span class="at">nCol =</span> <span class="dv">20</span>,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"response"</span>,<span class="at">main =</span><span class="st">"Set Shot Snap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="circling-back" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="circling-back"><span class="header-section-number">4.8</span> Circling back</h2>
<p>At the beginning, you may remember my reference to developing a model that not only describes the data-generating process well but also has good properties that can be tested via hypothesis testing. I have deliberately focused more on using visuals to identify the magnitude of the effects we have observed rather than delving deeply into hypothesis testing. While hypothesis testing is a valuable resource, using it successfully requires at least a basic understanding of which assumptions are valid for a given model and which are not.</p>
<p>For example, our initial model did not perform well because it was not specified correctly; we failed to account for the fact that there were many repeat observations among players. This violates the independence assumption of GLMs and affects the calculation of standard errors and p-values.</p>
<p>In practice, you would typically first identify the probability family appropriate for your response variable, such as binomial, Poisson, or Gaussian. Next, you would select models capable of handling those probability distributions and then check the assumptions underlying those models. Some assumptions can be identified as broken just by understanding your dataset, while others can only be tested after you have built the model.</p>
<section id="key-assumptions-to-consider" class="level3" data-number="4.8.1">
<h3 data-number="4.8.1" class="anchored" data-anchor-id="key-assumptions-to-consider"><span class="header-section-number">4.8.1</span> Key Assumptions to Consider</h3>
<ul>
<li><p><strong>Independence</strong>: For many models, including GLMs, observations are assumed to be independent. Violations of this assumption, such as repeated measures on the same subjects, need to be accounted for.</p></li>
<li><p><strong>Normality of Residuals</strong>: For linear models, residuals are often assumed to be normally distributed. This can be checked using diagnostic plots.</p></li>
<li><p><strong>Homoscedasticity</strong>: Constant variance of residuals is another common assumption. Heteroscedasticity can affect the efficiency of estimates and the validity of hypothesis tests.</p></li>
</ul>
</section>
<section id="practical-steps" class="level3" data-number="4.8.2">
<h3 data-number="4.8.2" class="anchored" data-anchor-id="practical-steps"><span class="header-section-number">4.8.2</span> Practical Steps</h3>
<ol type="1">
<li><p><strong>Identify the Probability Family</strong>:</p>
<ul>
<li>Determine whether your response variable follows a binomial, Poisson, Gaussian, or another distribution.</li>
</ul></li>
<li><p><strong>Model Selection</strong>:</p>
<ul>
<li>Choose models that are appropriate for the identified probability distribution.</li>
</ul></li>
<li><p><strong>Check Assumptions</strong>:</p>
<ul>
<li><p>Some assumptions, such as independence, can be known to be violated from understanding the dataset. For example, if the data includes repeated measures, this should be accounted for in the model.</p></li>
<li><p>Other assumptions, such as normality of residuals and homoscedasticity, can be tested after the model is built using diagnostic plots and tests.</p></li>
</ul></li>
<li><p><strong>Iterative Process</strong>:</p>
<ul>
<li>Model building is an iterative process. Start with a simple model, check assumptions, refine the model, and repeat as necessary.</li>
</ul></li>
</ol>
<p>By following these steps and being mindful of model assumptions, you can build more robust models and make more reliable inferences from your data</p>
<p>The below is a simple example of the subtle difference that can occur when specifying a model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>shot_small<span class="sc">$</span>dis_char <span class="ot">&lt;-</span> <span class="fu">as.character</span>(shot_small<span class="sc">$</span>shots.player.displayName)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Shot_outcome <span class="sc">~</span> shots.details.type ,<span class="at">data =</span> shot_small,<span class="at">family =</span> binomial)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>m1_glmer <span class="ot">=</span><span class="fu">glmer</span>(Shot_outcome <span class="sc">~</span> shots.details.type <span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span> dis_char),<span class="at">data =</span> shot_small,<span class="at">family =</span> binomial)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>s0 <span class="ot">&lt;-</span> <span class="fu">summary</span>(m0)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>sglmer <span class="ot">&lt;-</span><span class="fu">summary</span>(m1_glmer)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(s0<span class="sc">$</span>coefficients,<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                    Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                           -0.088      0.045  -1.958    0.050
shots.details.typeGeneral Play Snap   -0.348      0.058  -5.966    0.000
shots.details.typeGround Kick         -0.101      0.142  -0.709    0.478
shots.details.typeSet Shot Regular     0.167      0.053   3.122    0.002
shots.details.typeSet Shot Snap        0.481      0.088   5.495    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(sglmer<span class="sc">$</span>coefficients,<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                    Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                           -0.096      0.047  -2.047    0.041
shots.details.typeGeneral Play Snap   -0.363      0.059  -6.131    0.000
shots.details.typeGround Kick         -0.135      0.144  -0.942    0.346
shots.details.typeSet Shot Regular     0.135      0.055   2.465    0.014
shots.details.typeSet Shot Snap        0.459      0.089   5.126    0.000</code></pre>
</div>
</div>
</section>
</section>
<section id="final-models" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="final-models"><span class="header-section-number">4.9</span> Final Models</h2>
<section id="poisson-model" class="level3" data-number="4.9.1">
<h3 data-number="4.9.1" class="anchored" data-anchor-id="poisson-model"><span class="header-section-number">4.9.1</span> Poisson model</h3>
<p>Earlier we introduced the Poisson family regression for counts. Lets quickly explore trying to model TACKLES as a function of HARD_BALL_GET.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(data1<span class="sc">$</span>TACKLE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.66093</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(data1<span class="sc">$</span>TACKLE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.012247</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>count_model<span class="ot">=</span> <span class="fu">glm</span>(TACKLE<span class="sc">~</span>CONTESTED_POSSESSION,data1,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(count_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = TACKLE ~ CONTESTED_POSSESSION, family = "poisson", 
    data = data1)

Coefficients:
                     Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)          0.456261   0.012017   37.97   &lt;2e-16 ***
CONTESTED_POSSESSION 0.080189   0.001439   55.73   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 19097  on 9935  degrees of freedom
Residual deviance: 16299  on 9934  degrees of freedom
AIC: 40427

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>pred_count <span class="ot">&lt;-</span> <span class="fu">predict_response</span>(count_model)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_count,<span class="at">show_data =</span> T,<span class="at">jitter =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(count_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Not enough model terms in the conditional part of the model to check for
  multicollinearity.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="multinominial" class="level3" data-number="4.9.2">
<h3 data-number="4.9.2" class="anchored" data-anchor-id="multinominial"><span class="header-section-number">4.9.2</span> Multinominial</h3>
<p>Lets say you were actually interested in modelling GOAL, BEHIND and MISS. Not just GOAL, MISS as we were before. You could do that using what is called a multinominal regression. This is extension of the GLM frame work but we have to use a different package to do this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>mnommod<span class="ot">&lt;-</span> <span class="fu">multinom</span>(shots.result.code<span class="sc">~</span>Rotated.xStd<span class="sc">+</span>Rotated.yStd,<span class="at">data =</span> data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># weights:  12 (6 variable)
initial  value 11962.789211 
iter  10 value 11098.696107
iter  10 value 11098.696107
iter  10 value 11098.696107
final  value 11098.696107 
converged</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggeffect</span>(mnommod, <span class="at">terms =</span> <span class="st">"Rotated.xStd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="module3_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="what-we-didnt-get-time-to-explore" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="what-we-didnt-get-time-to-explore"><span class="header-section-number">4.10</span> What we didn’t get time to explore</h2>
<ul>
<li><p><strong>Gaussian regression</strong></p></li>
<li><p><strong>Poisson regression</strong></p></li>
<li><p><strong>Binomial regression (classification)</strong></p></li>
<li><p>Fractional binomial regression</p></li>
<li><p>Quasibinomial regression</p></li>
<li><p><strong>Multinomial classification</strong></p></li>
<li><p>Gamma regression</p></li>
<li><p>Ordinal regression</p></li>
<li><p>Negative Binomial regression</p></li>
<li><p>Tweedie distribution</p></li>
</ul>
</section>
<section id="next-module" class="level2" data-number="4.11">
<h2 data-number="4.11" class="anchored" data-anchor-id="next-module"><span class="header-section-number">4.11</span> Next module</h2>
<p>We are going to skip a lot of the math and look to say who really cares about all the technical stuff, lets just see how well we can predict something.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./module2.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Module 2</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./module4.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Module 4</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>